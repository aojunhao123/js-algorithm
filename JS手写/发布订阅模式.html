<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
</head>

<body>
    <script>
        // äº‹ä»¶ä¸­å¿ƒ
        class PubSub {
            constructor() {
                // ç”¨äºå­˜å‚¨å‘å¸ƒçš„äº‹ä»¶
                // å­˜å‚¨æ ¼å¼ï¼ševentNameï¼šEventCallback[]
                // äº‹ä»¶ä¸­å­˜æ”¾ç€è®¢é˜…è€…çš„å›è°ƒå‡½æ•°
                this.events = {}
            }
            // è®¢é˜…æ–¹æ³•
            subscribe(name, cb) {
                if (!this.events[name]) {
                    this.events[name] = []
                }
                // å°†è®¢é˜…è€…çš„å›è°ƒå‡½æ•°æ”¾å…¥æ•°ç»„
                this.events[name].push(cb)
            }
            // å‘å¸ƒæ–¹æ³•
            publish(name, ...args) {
                if (this.events[name]) {
                    // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…å¹¶æ‰§è¡Œè®¢é˜…è€…çš„ç›¸åº”å›è°ƒ
                    this.events[name].forEach(cb => cb(...args));
                }
            }
            // å–æ¶ˆè®¢é˜…
            unSubscribe(name, cb) {
                if (this.events[name]) {
                    this.events[name] = this.events[name].filter(item => item !== cb)
                }
                if (this.events[name].length === 0) {
                    delete this.events[name]
                }
            }
            // å–æ¶ˆå…¨éƒ¨è®¢é˜…
            unSubscribeAll(name) {
                // åˆ é™¤è¯¥äº‹ä»¶å¯¹åº”çš„å›è°ƒæ•°ç»„
                delete this.events[name]
            }
        }

        // åˆ›å»ºäº‹ä»¶ä¸­å¿ƒ
        const pubsub = new PubSub()

        // è®¢é˜…
        pubsub.subscribe('hunting', (info) => {
            console.log(`æˆ‘çš„ä»»åŠ¡æ˜¯ï¼š${info}`);
        })
        pubsub.subscribe('dancing', (info) => {
            console.log(`æˆ‘æƒ³è·³èˆï¼š${info}`);
        })

        // å‘å¸ƒ
        pubsub.publish('hunting', 'æŠ“ä¸€åªç»ƒä¹ æ—¶é•¿ä¸¤å¹´åŠçš„å°é»‘å­~')
        pubsub.publish('hunting', 'æŠ“ä¸€åªè”¡å¾é²²~')
        pubsub.publish('dancing', 'ğŸ”æ³¥å¤ªç…¤~')
    </script>
</body>

</html>